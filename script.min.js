window.onload=function(){getData("server.php",0,"");setTimeout(function(){buildHtml(0);uparr=__("uparr");uparrLen=uparr.length;dnarr=__("dnarr");dnarrLen=dnarr.length;for(var a=0;a<uparrLen;a++)uparr[a].addEventListener("click",function(){sortTbl("asc",this.id)});for(a=0;a<dnarrLen;a++)dnarr[a].addEventListener("click",function(){sortTbl("desc",this.id)});_("inputVal").addEventListener("input",function(){filterTbl(this.value)});_("rowLimit").addEventListener("change",function(){buildHtml(0)})},350)};
var _=function(a){return document.getElementById(a)},__=function(a){return document.getElementsByClassName(a)},tempData=[],renderedData=[],originalData=[],log=function(a){return console.log(a)};
function getData(a,e,c){_("tbody").innerHTML="<tr><td colspan=7 align='center' height='50'><span class='info'>Loading..</span></td></tr>";var d=null,d=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");d.open("POST",a,!0);d.send(e);d.onreadystatechange=function(){4==d.readyState&&parse(d.responseText,c)}}function parse(a,e){var c=JSON.parse(a),d=c.length,b;for(b=0;b<d;b++)originalData.push(c[b])}
function filterTbl(a){tempData=[];if(void 0==a||""==a)return buildHtml(0),!0;var e=originalData.length;a=a.toLowerCase();for(var c=0;c<e;c++)for(var d in originalData[c])if(0<=originalData[c][d].toString().toLowerCase().indexOf(a)){tempData.push(originalData[c]);break}buildHtml(0)}
function sortTbl(a,e){for(var c=_(e),d=0;d<uparrLen;d++)uparr[d].classList.remove("active-sort"),dnarr[d].classList.remove("active-sort");c.classList.add("active-sort");for(var c=c.getAttribute("data-field"),b=0==renderedData.length?originalData:renderedData,h=b.length,g,d=0;d<h;d++)for(var f=0;f<h-1;f++)"asc"==a?b[f][c]>b[f+1][c]&&(g=b[f+1],b[f+1]=b[f],b[f]=g):b[f][c]<b[f+1][c]&&(g=b[f+1],b[f+1]=b[f],b[f]=g);buildSortedHtml()}
function buildSortedHtml(){for(var a=renderedData,e=a.length,c="",d=0;d<e;d++){var c=c+"<tr>",b;for(b in a[d])c+="<td>"+a[d][b]+"</td>";c+="</tr>"}_("tbody").innerHTML=c}
function buildHtml(a){renderedData=[];a=void 0==a?0:a;var e=Object.keys(originalData[0]),c=e.length,d=_("tbody"),b=_("tblCols"),h=_("tfoot");""==b.innerHTML&&buildHeader(c);var g=document.getElementById("inputVal").value,g=0==tempData.length&&""==g?originalData:tempData,f=g.length,l="",k=_("rowLimit").value,q=k*a,k=parseInt(q)+parseInt(k),k=k>f?f:k;if(0<f){for(var p="",t=0,m=q;m<k;m++){renderedData.push(g[m]);var p=p+"<tr>",n=0,r;for(r in g[m])0===t&&(l+="<th>"+e[n]+'<span class="uparr" data-field="'+
e[n]+'" id="uarr'+n+'" title="Sort ASC">&uarr;</span><span class="dnarr" data-field="'+e[n]+'" id="darr'+n+'" title="Sort DESC">&darr;</span></th>'),p+='<td title="'+g[m][r]+'">'+g[m][r]+"</td>",n++;p+="</tr>";t++}""==b.innerHTML&&(b.innerHTML=l);d.innerHTML=p;h.innerHTML=buildFooter(f,c,a,q,k)}else d.innerHTML="<tr><td colspan="+c+" align='center' height='50'><span class='error'>No records found..</span></td></tr>"}
function buildHeader(a){a=parseInt(a)-1;a='<td colspan="'+a+'"> <input type="search" id="inputVal" placeholder="Search table"></td><td title="% Rows displayed "><select id="rowLimit">';for(var e=50;500>=e;e+=50)a+="<option value="+e+">"+e+"</option>";a+="</select></td>";_("tblNav").innerHTML=a}
function buildFooter(a,e,c,d,b){var h=_("rowLimit").value;var g=a/h;e='<tr><td colspan="'+e+'"><span class="record-info"> Records displayed  : '+renderedData.length+" ("+parseInt(d+1)+" to "+b+") of "+a+'</span> <span class="paging">';if(a>h)for(b=0;b<g;b++){d=b==c?"activePg":"";5>b&&(e+='<button class="pgBtn '+d+'"  onclick=pageData(this) data-pgno='+parseInt(b)+">"+parseInt(b+1)+"</button>");if(5<b&&6>=b){var f=parseInt(c)+1,l=parseInt(c)-1;h=0>parseInt(l)?"disabled":"";a=f>=g?"disabled":"";var k=
l+1;e+='<button class="pgBtn  '+a+'" onclick=pageData(this) '+a+" data-pgno="+f+" >Next -> "+(f+1)+"</button>";e+='<button class="pgBtn '+h+'" onclick=pageData(this) '+h+" data-pgno="+l+">"+k+" <- Prev </button>"}b>g-1&&(e+='<button class="pgBtn '+d+'" onclick=pageData(this) data-pgno='+parseInt(b)+">Last</button>")}return e+"</span></td></tr>"}function pageData(a){a.classList.add("activePg");a=a.getAttribute("data-pgno");buildHtml(a)};
